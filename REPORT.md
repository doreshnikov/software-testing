## Homework 1

#### Main

* ✔️ создана папка [`client`](client)
* ✔️ в ней размещено приложение на _Vue.js_
* ✔️ 5 страниц (+рутинг)
* ✔️ unit-тесты и компонентные тесты (_jest_, _@vue/test-utils_)

---

#### Advanced

* ✔️ авторизация (`jwt` + `localStorage`, _Vuex_)
    * есть тесты для проверки авторизации на компонентном уровне
* ✔️ достаточно много наборов тестов

---

#### Bonus

* ✔️ e2e тесты на _Cypress_ и _Playwright_
    * см. задание номер 2
* ✔️ сравнение _Cypress_ и _Playwright_
    * см. задание номер 2

---

```bash
cd client
npm run test:uc
# jest test/unit test/component
```

Тесты находятся в каталоге [`test`](client/test). Для unit-тестирования и компонентного тестирования использовался _
jest_ с _@vue/test-utils_.

* `test/unit/` &ndash; unit-тесты
    * [`utils.test.js`](client/test/unit/utils.test.js)
      тестирование вспомогательных функций
    * [`store.test.js`](client/test/unit/store.test.js)
      тестирование _Vuex_-хранилищ
* `test/component/` &ndash; компонентные тесты
    * [`fragments.test.js`](client/test/component/fragments.test.js)
      тестирование общих компонент
    * `pages/`
      тестирование компонент, относящихся к определенным страницам
        * [`home.test.js`](client/test/component/pages/home.test.js)
        * [`login.test.js`](client/test/component/pages/login.test.js)
        * [`title.test.js`](client/test/component/pages/title.test.js)

---

## Homework 2

#### Main

* ✔️ написан несложный [`server-js`](server-js) с использованием _Express.js_
* ✔️ e2e тесты (_Cypress_, _Playwright_)
    * тесты на прохождение авторизации
    * тесты на стили и внешний вид сервиса
    * тесты на нетривиальные сюжеты взаимодействия пользователя и сервиса

---

#### Advanced

* ✔️ e2e тесты с единоразовым прохождением авторизации
    * на _Cypress_ &ndash; мучение с сохранением `localStorage`
    * на _Playwright_ достаточно просто адекватно пользоваться `beforeAll(...)`

---

#### Bonus

* ✔️ e2e тесты со скриншот-тестированием и записью видео
    * тесты на _Cypress_ ведут запись видео самостоятельно
    * есть тесты на _Cypress_, расчитанные на сравнение двух скриншотов, однако ввиду ограниченности времени и ресурсов,
      они интегрированы в другие тесты, и просто сохраняют скриншоты рядом друг с другом для ручного сравнения
* ❌ для статьи тут материала маловато будет, могу просто сказать, что в процессе написания тестов несколько раз видео
  помогали мне найти ошибки, которые не были найдены в unit или компонентных тестах просто потому что о таких тестах ты
  даже не задумываешься, пока не увидишь, например:
    * &laquo;мерцание&raquo; ошибки загрузки ресурса
    * отображение компоненты при передаче в нее странного вида невалидных `props`

---

```bash
cd client && npm run deploy
# cd server && npm run start && cd ../client && npm run serve

npm run test:e2e:c
# npx cypress run
npm run test:e2e
# jest test/e2e/playwright
```

* `test/e2e/cypress` &ndash; тесты _Cypress_
    * [`authentication.test.js`](client/test/e2e/cypress/authentication.test.js)
      тестирование авторизации и возможности сохранять состояние
    * [`navigation.test.js`](client/test/e2e/cypress/navigation.test.js)
      тестирование реакции сервиса на navbar с _VueRouter_
    * [`requests.test.js`](client/test/e2e/cypress/requests.test.js)
      тестирование возможностей авторизованного пользователя
* `test/e2e/playwright` &ndash; тесты _Playwright_
    * [`interceptors.test.js`](client/test/e2e/playwright/interceptors.test.js)
      тестирование надстройки над _axios_, обрабатывающей ошибки доступа
    * [`views.test.js`](client/test/e2e/playwright/views.test.js)
      тестирование внешнего вида компонент (формально не являются e2e-тестами, однако не могут быть без реальной
      отрисовки компонент)

### Немного фактов

**Cypress**, на данный момент &ndash; намного более популярный фреймворк, что звучит довольно печально после моих
попыток подружиться с ним. Из его плюсов хочется в основном отметить

* хорошую визуализацию исполнения
* возможность ставить брейкпойнты для исполнения в режиме `npx cypress open`
* автоматическую запись видео прохождения тестов
* как ни удивительно, популярность
    * множество обсуждений на форумах является приятным дополнением к официальной документации, которая тоже более
      ясная, чем у _Playwright_

Записанные видео сэкономили мне много времени, которое могло уйти на попытки разобраться что где пошло не так, как и
возможность отследить что происходило с тестовым окружением на каждом шаге.

Тем не менее, гораздо больше запомнились некоторые его проблемы. Самая небольшая &ndash; что _Cypress_ нельзя запустить
из-под _jest_, и после нескольких часов написания тестов на _jest_, очень сложно понять почему вдруг что-то не работает,
хотя это конечно дело привычки.

Заметно больше неприятностей приносят факты, что

* поиск по селекторам в большинстве мест заменяется на `.contains(...)`, который при этом достаточно не интуитивно
  возвращает ребенка, а не исходную вершину, после чего приходится применять `.parentsUntil(...)`
* строковые представления assertions из _Chai_ тоже не сильно помогают быстрому написанию кода
* приложению с авторизацией через `jwt` в `localStorage` очень неприятно, когда перед каждым тестом `localStorage`
  forcibly сбрасывается
* примерно в той же степени, как и приложению с рутингом не очень здорово, когда история посещений сбрасывается после
  каждого `cy.visit(...)` несмотря на то, что под капотом есть возможность добавлять новый путь поверх истории, а не
  вместо

В **Playwright** с этим все намного лучше. Во-первых, огромный выбор (в том числе shadow)
селекторов, позволяющих очень гибко выбирать вершины DOM-дерева. Локальное хранилище и история не подвергаются
постоянному опустошению, и из-за всего вышеперечисленного код получается гораздо приятнее и компактнее. Еще несколько
важных отличий:

* в _Playwright_ все простроено на асинхронных `Promises`, что в частности позволяет ждать отклика от некоторого
  действия в явном виде с помощью `await`, а не с помощью ручной задержки исполнения `cy.wait(...)`
* можно выбрать под каким устройством и браузером запускать тесты

Из наиболее отрицательных качеств _Playwright_ &ndash; совершенно невозможно найти как делать что-то нетривиальное, пока
не перероешь весь интернет. Кажется, что про _Playwright_ почти никто ничего не говорит и никто им не пользуется. Плюс,
нет такого удобного debugger-like окружения, которое сильно помогло в случае с
_Cypress_.


---

## Homework 3

#### Main

* ✔️ создан бэкэнд сервиса на _Kotlin_ + _Ktor_
    * контроллеры на `user` и `titles`, как и в предыдущих заданиях
* ✔️ есть unit и компонентные тесты
* ✔️ есть тесты с использованием _Testcontainers_
    * для них пришлось активно вооружаться докером
    * в качестве альтернативы есть тесты с in-memory базой данных
* ❌ нет тестов с явным использованием _Mockito_
    * было некуда их приделывать, потому что repository-прослойкой между базой данных и сервисом является ORM и DAO, а
      соответственно мокировать особо нечего
    * вместо этого есть тесты с использованием _MockClient_ для мокирования общения с внешним сервисом

---

#### Advanced

* ✔️ полностью налажено взаимодействие между клиентом и сервером
    * все e2e тесты **клиента** успешно проходят, в том числе, разумеется, и тесты на авторизацию
    * добавлены новые e2e-тесты с использованием `withTestApplication()`, тестирующие корректную реакцию на запросы
* ❌ сделать генерацию документации

---

```bash
# run server
./gradlew run
# test server
./gradlew test 
```

* [`CryptoHashTest`](server-jvm/test/common/CryptoHashTest.kt) юнит тесты для хешера паролей
* [`ApplicationTest`](server-jvm/test/controller/ApplicationTest.kt) 
    * тесты работы контроллеров и рутов api, используют _Testcontainers_
* [`ValidationTest`](server-jvm/test/model/ValidationTest.kt) юнит тесты валидации приходящих данных
* [`DBServiceTest`](server-jvm/test/service/DBServiceTest.kt) компонентные тесты сервисов
* [`HttpClientServiceTest`](server-jvm/test/service/HttpClientServiceTest.kt) тест с моком внешнего сервиса (MAL)

## Homework 4

* ✔️ созданы _GitHub Actions_ для запуска тестов UI
    * [`test.client.uc.yaml`](.github/workflows/test.client.uc.yaml) unit и component тесты
    * [`test.client.e2e.yaml`](.github/workflows/test.client.e2e.yaml) e2e тесты с разверткой _Express.js_-бэкэнда
* ❌ пока нет тестов бэкэнда
* ❌ пока нет CD на Azure/etc